!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("StReportSdk",[],t):"object"==typeof exports?exports.StReportSdk=t():e.StReportSdk=t()}(this,function(){return function(e){function t(n){if(r[n])return r[n].exports;var o=r[n]={exports:{},id:n,loaded:!1};return e[n].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";t.__esModule=!0;var n=r(1);e.exports=e.exports["default"]=n["default"]},function(e,t,r){"use strict";function n(){f=+new Date}var o="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},i=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},a=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++){t=arguments[r];for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o])}return e},c=function(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols)for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]]);return r};t.__esModule=!0;var u=r(2),s=r(5),d=r(6),p=r(9);window.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("hashchange",n,!1);var f,l=function(){function e(e){var t=void 0===e?{}:e,r=t.disableGetRequireQsFromUrl,n=void 0!==r&&r,o=t.qsWhiteList,i=void 0===o?[]:o,a=t.apiAddress,c=t.projectIdentifier,u=t.eventTags,s=t.eventGroup,d=t.autoDetectUtmSource,p=void 0===d||d,f=t.debug,l=void 0!==f&&f;this.disableGetRequireQsFromUrl=n,this.qsWhiteList=i,this.apiAddress=a,this.eventTags=u,this.eventGroup=s,this.projectIdentifier=c,this.autoDetectUtmSource=p,this.debug=l}return e.getInstance=function(t,r){void 0===t&&(t={});var n=t.projectIdentifier,o=t.eventTags,i=t.eventGroup,u=c(t,["projectIdentifier","eventTags","eventGroup"]);return"string"==typeof arguments[0]&&(n=arguments[0]),new e(a({},e.defaultProps,{projectIdentifier:n,eventTags:o,eventGroup:i,debug:r},u))},e.getPageViewId=function(){var t=e.pageViewCache.uid;return t||(e.pageViewCache={currentUrl:location.href,uid:d()}),e.pageViewCache.uid},e.prototype.report=function(t){var r=void 0===t?{}:t,n=r.projectIdentifier,o=r.eventName,c=r.eventGroup,u=r.eventDescription,s=r.eventDataValue,d=r.eventTags,p=void 0===d?[]:d,f=(r.referer,r.shouldSendBeacon),l=this.disableGetRequireQsFromUrl?{}:this.getWhiteListLocationSearchObject(),v=this.apiAddress,g=n||this.projectIdentifier;if(c&&"string"!=typeof c)throw new Error("事件分组 event group 必须为 string 类型");var m=c||this.eventGroup,y=u,h=s,b=o,w=Array.isArray(p)&&p.length?p:this.eventTags,j=e.getPageViewId(),x=document.referrer,S=a({p:g,ev_g:m,ev_desc:y,ev_d:h,ev_n:b,ev_tag:w,pv_id:j,prev_ref:x},e.getDeviceSize()),k=e.convertObjectToRequestParams(i(S,l)),O=v+"?"+encodeURIComponent(k);this.debugLog("report custom request params: ",S),this.debugLog("report white list location search object: ",l),this.debugLog("report request params: ",k),this.debugLog("report api address: ",v),e.isSendBeaconSupported()&&f?e.reportRequestViaBeacon(O):e.reportRequestViaImage(O)},e.getDeviceSize=function(){var t=window.innerWidth||0,r=window.innerHeight||0;return{ua_cw:t,ua_ch:r,ua_cwh:t+"x"+r,ua_device_cwh:window.screen.width+"x"+window.screen.height,ua_device_csr:e.getScreenRatioArr(window.screen.width,window.screen.height).join(":"),ua_csr:e.getScreenRatioArr(t,r).join(":"),ua_co:window.innerHeight>window.innerWidth?"portrait":"landscape"}},e.getScreenRatioArr=function(e,t){if(!e||!t)return[e,t];var r=Math.max(e,t),n=Math.min(e,t),o=[9,Number((r/n*9).toFixed(2))];return e>t&&o.reverse(),o},e.prototype.trackClick=function(e,t){this.report({eventName:e,eventDataValue:t})},e.prototype.pageLoad=function(t){void 0===t&&(t={});var r=t.eventDataValue,n=void 0===r?{}:r,o=c(t,["eventDataValue"]);n=i(n,{td_pl:e.getDiffRouteTime(),ts:+new Date}),this.report(a({eventName:"load_page",eventDataValue:n},o))},e.prototype.pageLeave=function(t){void 0===t&&(t={});var r=t.eventDataValue,n=void 0===r?{}:r,o=c(t,["eventDataValue"]);n=i(n,{td_pl:e.getDiffRouteTime(),ts:+new Date}),this.report(a({eventName:"page_leave",shouldSendBeacon:!0,eventDataValue:n},o))},e.prototype.trackPageLoad=function(e){var t=this;void 0===e&&(e={}),s["default"]("load",function(){t.pageLoad(e)})},e.prototype.trackPageLeave=function(e){var t=this;void 0===e&&(e={}),window.addEventListener("beforeunload",function(){t.pageLeave(e)},!0)},e.prototype.trackRoutePageLoad=function(e){this.pageLoad(e)},e.getDiffRouteTime=function(){return f?+new Date-f:0},e.prototype.getWhiteListLocationSearchObject=function(){var t=this.qsWhiteList,r=e.getLocationSearchObject();return this.autoDetectUtmSource&&(r.utm_source||(r.utm_source=p["default"]())),Object.keys(r).reduce(function(e,n){return t.indexOf(n)>-1&&(e[n]=r[n]),e},{})},e.removeObjectUndefinedProps=function(e){var t={};for(var r in e)e.hasOwnProperty(r)&&void 0!==e[r]&&(t[r]=e[r]);return t},e.prototype.debugLog=function(t,r){if(this.debug)try{"object"===("undefined"==typeof r?"undefined":o(r))?(console.log("st-report-sdk: "+t),console.table(e.removeObjectUndefinedProps(r))):console.log("st-report-sdk: "+t,r)}catch(n){console.log("st-report-sdk: "+t,r)}},e.getLocationSearchObject=function(){return u.parse(location.search)},e.convertObjectToRequestParams=function(e){return JSON.stringify(e)},e.isSendBeaconSupported=function(){return navigator&&navigator.sendBeacon},e.reportRequestViaImage=function(e){(new Image).src=e},e.reportRequestViaBeacon=function(e){navigator.sendBeacon(e)},e.defaultProps={qsWhiteList:["utm_source","utm_medium","utm_term","utm_content","utm_campaign"],apiAddress:"//st.xoyo.com/report/web"},e.pageViewCache={},e}();t["default"]=l},function(e,t,r){"use strict";function n(e){switch(e.arrayFormat){case"index":return function(t,r,n){return null===r?[i(t,e),"[",n,"]"].join(""):[i(t,e),"[",i(n,e),"]=",i(r,e)].join("")};case"bracket":return function(t,r){return null===r?[i(t,e),"[]"].join(""):[i(t,e),"[]=",i(r,e)].join("")};default:return function(t,r){return null===r?i(t,e):[i(t,e),"=",i(r,e)].join("")}}}function o(e){var t;switch(e.arrayFormat){case"index":return function(e,r,n){return t=/\[(\d*)\]$/.exec(e),e=e.replace(/\[\d*\]$/,""),t?(void 0===n[e]&&(n[e]={}),void(n[e][t[1]]=r)):void(n[e]=r)};case"bracket":return function(e,r,n){return t=/(\[\])$/.exec(e),e=e.replace(/\[\]$/,""),t?void 0===n[e]?void(n[e]=[r]):void(n[e]=[].concat(n[e],r)):void(n[e]=r)};default:return function(e,t,r){return void 0===r[e]?void(r[e]=t):void(r[e]=[].concat(r[e],t))}}}function i(e,t){return t.encode?t.strict?f(e):encodeURIComponent(e):e}function a(e,t){return t.decode?l(e):e}function c(e){return Array.isArray(e)?e.sort():"object"===("undefined"==typeof e?"undefined":p(e))?c(Object.keys(e)).sort(function(e,t){return Number(e)-Number(t)}).map(function(t){return e[t]}):e}function u(e){var t=e.indexOf("?");return t===-1?"":e.slice(t+1)}function s(e,t){t=d({decode:!0,arrayFormat:"none"},t);var r=o(t),n=Object.create(null);if("string"!=typeof e)return n;if(e=e.trim().replace(/^[?#&]/,""),!e)return n;for(var i=0,u=e.split("&");i<u.length;i++){var s=u[i],f=s.replace(/\+/g," ").split("="),l=f[0],v=f[1];v=void 0===v?null:a(v,t),r(a(l,t),v,n)}return Object.keys(n).sort().reduce(function(e,t){var r=n[t];return Boolean(r)&&"object"===("undefined"==typeof r?"undefined":p(r))&&!Array.isArray(r)?e[t]=c(r):e[t]=r,e},Object.create(null))}var d=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},p="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},f=r(3),l=r(4);t.extract=u,t.parse=s,t.stringify=function(e,t){var r={encode:!0,strict:!0,arrayFormat:"none"};t=d(r,t),t.sort===!1&&(t.sort=function(){});var o=n(t);return e?Object.keys(e).sort(t.sort).map(function(r){var n=e[r];if(void 0===n)return"";if(null===n)return i(r,t);if(Array.isArray(n)){for(var a=[],c=0,u=n.slice();c<u.length;c++){var s=u[c];void 0!==s&&a.push(o(r,s,a.length))}return a.join("&")}return i(r,t)+"="+i(n,t)}).filter(function(e){return e.length>0}).join("&"):""},t.parseUrl=function(e,t){return{url:e.split("?")[0]||"",query:s(u(e),t)}}},function(e,t){"use strict";e.exports=function(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}},function(e,t){"use strict";function r(e,t){try{return decodeURIComponent(e.join(""))}catch(n){}if(1===e.length)return e;t=t||1;var o=e.slice(0,t),i=e.slice(t);return Array.prototype.concat.call([],r(o),r(i))}function n(e){try{return decodeURIComponent(e)}catch(t){for(var n=e.match(c),o=1;o<n.length;o++)e=r(n,o).join(""),n=e.match(c);return e}}function o(e){for(var t={"%FE%FF":"��","%FF%FE":"��"},r=u.exec(e);r;){try{t[r[0]]=decodeURIComponent(r[0])}catch(o){var i=n(r[0]);i!==r[0]&&(t[r[0]]=i)}r=u.exec(e)}t["%C2"]="�";for(var a=Object.keys(t),c=0;c<a.length;c++){var s=a[c];e=e.replace(new RegExp(s,"g"),t[s])}return e}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a="%[a-f0-9]{2}",c=new RegExp(a,"gi"),u=new RegExp("("+a+")+","gi");e.exports=function(e){if("string"!=typeof e)throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+("undefined"==typeof e?"undefined":i(e))+"`");try{return e=e.replace(/\+/g," "),decodeURIComponent(e)}catch(t){return o(e)}}},function(e,t){"use strict";function r(e,t){window.attachEvent?(window["e"+e+t]=t,window[e+t]=function(){window["e"+e+t](window.event)},window.attachEvent("on"+e,window[e+t])):window.addEventListener(e,t,!1)}t.__esModule=!0,t["default"]=r},function(e,t,r){"use strict";function n(e,t,r){var n=t&&r||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null),e=e||{};var a=e.random||(e.rng||o)();if(a[6]=15&a[6]|64,a[8]=63&a[8]|128,t)for(var c=0;c<16;++c)t[n+c]=a[c];return t||i(a)}var o=r(7),i=r(8);e.exports=n},function(e,t){"use strict";var r="undefined"!=typeof crypto&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&msCrypto.getRandomValues.bind(msCrypto);if(r){var n=new Uint8Array(16);e.exports=function(){return r(n),n}}else{var o=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0===(3&t)&&(e=4294967296*Math.random()),o[t]=e>>>((3&t)<<3)&255;return o}}},function(e,t){"use strict";function r(e,t){var r=t||0,o=n;return o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+"-"+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]+o[e[r++]]}for(var n=[],o=0;o<256;++o)n[o]=(o+256).toString(16).substr(1);e.exports=r},function(e,t,r){"use strict";function n(){return o.isJianghuDaily()?"daily":o.isWeiXin()?"wx":o.isMWeibo()?"wb":o.isMQQ()?"qq":void 0}t.__esModule=!0;var o=r(10);t["default"]=n},function(e,t){"use strict";function r(){var e=navigator.userAgent||navigator.vendor||window.opera;return e.toLowerCase()}function n(){var e=r();return/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series([46])0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(e)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br([ev])w|bumb|bw-([nu])|c55\/|capi|ccwa|cdm-|cell|chtm|cldc|cmd-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc-s|devi|dica|dmob|do([cp])o|ds(12|-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly([-_])|g1 u|g560|gene|gf-5|g-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd-([mpt])|hei-|hi(pt|ta)|hp( i|ip)|hs-c|ht(c([- _agpst])|tp)|hu(aw|tc)|i-(20|go|ma)|i230|iac([ -\/])|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja([tv])a|jbro|jemu|jigs|kddi|keji|kgt([ \/])|klon|kpt |kwc-|kyo([ck])|le(no|xi)|lg( g|\/([klu])|50|54|-[a-w])|libw|lynx|m1-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t([- ov])|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30([02])|n50([025])|n7(0([01])|10)|ne(([cm])-|on|tf|wf|wg|wt)|nok([6i])|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan([adt])|pdxg|pg(13|-([1-8]|c))|phil|pire|pl(ay|uc)|pn-2|po(ck|rt|se)|prox|psio|pt-g|qa-a|qc(07|12|21|32|60|-[2-7]|i-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h-|oo|p-)|sdk\/|se(c([-01])|47|mc|nd|ri)|sgh-|shar|sie([-m])|sk-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h-|v-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl-|tdg-|tel([im])|tim-|t-mo|to(pl|sh)|ts(70|m-|m3|m5)|tx-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c([- ])|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas-|your|zeto|zte-/i.test(e.substr(0,4))}function o(){return/android/i.test(r())}function i(){return/iPad|iPhone|iPod/i.test(r())&&!window.MSStream}function a(){var e=r();return"micromessenger"===String(e.match(/MicroMessenger/i))}function c(){return n()&&a()}function u(){var e=r(),t=i()&&/ QQ/i.test(e),a=o()&&/MQQBrowser/i.test(navigator.userAgent)&&/QQ/i.test(e.split("mqqbrowser"));return n()&&(t||a)}function s(){var e=r();return n()&&/(weibo)/.test(e)}function d(){var e=r();return/jianghudaily/i.test(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.getUserAgent=r,t.isMobile=n,t.isAndroid=o,t.isIOS=i,t.isWeiXin=a,t.isMWeiXin=c,t.isMQQ=u,t.isMWeibo=s,t.isJianghuDaily=d}])});
//# sourceMappingURL=st-report-sdk.min.js.map